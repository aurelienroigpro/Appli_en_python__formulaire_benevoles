import streamlit as st
import pandas as pd
import plotly.express as px

# ----------------------------
# Donn√©es fictives (liste de listes)
# ----------------------------
data = [
    ["Martin","Claire","Femme","75012","Paris","23","Rue de Reuilly","claire.martin@gmail.com","0612345678","Week-ends","Communication","Oui"],
    ["Lefevre","Thomas","Homme","69007","Lyon","18","Rue Garibaldi","thomas.lefevre@outlook.fr","0789456123","Soirs de semaine","Logistique","Non"],
    ["Dubois","Emile","Homme","31000","Toulouse","5","Rue du Taur","emma.dubois@yahoo.fr","0654789123","Vacances scolaires","Animation","Oui"],
    ["Bernard","Lucas","Homme","44000","Nantes","42","Quai de la Fosse","lucas.bernard@live.fr","0778459632","Mercredis","Informatique","Oui"],
    ["Petit","Julie","Femme","13005","Marseille","12","Boulevard Baille","julie.petit@gmail.com","0698453214","Soirs et week-ends","Comptabilit√©","Non"],
    ["Moreau","Hugo","Homme","64000","Pau","9","Rue des Orf√®vres","hugo.moreau@free.fr","0668459741","Samedis","Organisation d‚Äô√©v√©nements","Oui"],
    ["Girard","L√©a","Femme","34000","Montpellier","27","Avenue Cl√©menceau","lea.girard@hotmail.com","0678451212","Vacances d‚Äô√©t√©","Animation enfants","Oui"],
    ["Laurent","Mathilde","Femme","54000","Nancy","15","Rue Nationale","mathieu.laurent@gmail.com","0647895412","Week-ends","Bricolage","Non"],
    ["Garcia","Chlo√©","Femme","75015","Paris","3","Rue Lecourbe","chloe.garcia@gmail.com","0665428741","Soirs","Graphisme","Oui"],
    ["Rousseau","Julien","Homme","33000","Bordeaux","8","Cours Victor Hugo","julien.rousseau@orange.fr","0612458796","Dimanches","Photographie","Oui"],
    ["Mercier","Camille","Femme","72000","Le Mans","24","Rue Gambetta","camille.mercier@gmail.com","0658412233","Soirs et samedis","Relations publiques","Oui"],
    ["Dupont","Antoine","Homme","64000","Pau","19","Rue Serviez","antoine.dupont@yahoo.fr","0678459654","Samedis matin","Cuisine collective","Non"],
    ["Faure","Manon","Femme","80000","Amiens","33","Rue Saint-Fuscien","manon.faure@gmail.com","0765123487","Week-ends","Accueil","Oui"],
    ["Blanchard","Louise","Femme","75000","Paris","20","Rue Saint-Jean","louis.blanchard@live.fr","0654789632","Lundi soir","Gestion de projet","Oui"],
    ["Lambert","Sarah","Femme","75000","Paris","17","Rue du Barachois","sarah.lambert@gmail.com","0692123456","Soirs de semaine","Couture","Non"],
    ["Fontaine","Arthur","Homme","21000","Dijon","12","Rue Verrerie","arthur.fontaine@gmail.com","0689547412","Week-ends","Informatique","Oui"],
    ["Chevalier","Ana√Øs","Femme","83000","Toulon","4","Avenue de la R√©publique","anais.chevalier@orange.fr","0645879632","Vacances","Danse","Oui"],
    ["Gauthier","Nicole","Femme","38000","Grenoble","27","Rue Lesdigui√®res","nicolas.gauthier@gmail.com","0663214789","Soirs","Communication","Non"],
    ["Morel","Elise","Femme","75000","Paris","31","Boulevard de la Libert√©","elise.morel@gmail.com","0621548796","Samedis","√âv√©nementiel","Oui"],
    ["Lefranc","Adrien","Homme","45000","Orl√©ans","21","Rue Royale","adrien.lefranc@gmail.com","0754123689","Week-ends","Sport encadrement","Oui"],
    ["Caron","In√®s","Femme","54000","Nancy","10","Rue Saint-Georges","ines.caron@hotmail.fr","0689523147","Mercredis","Graphisme","Non"],
    ["Roy","Quentin","Homme","80000","Amiens","7","Rue Jules-Barni","quentin.roy@gmail.com","0678124596","Soirs","Aide administrative","Oui"],
    ["Robin","Lucie","Femme","69002","Lyon","5","Rue Merci√®re","lucie.robin@gmail.com","0698741254","Week-ends","√âducation","Oui"],
    ["Colin","Ethan","Homme","64000","Pau","44","Rue Marca","ethan.colin@gmail.com","0789451236","Vacances","Jardinage","Non"],
    ["Vidal","Jeanne","Femme","86000","Poitiers","18","Rue Magenta","jeanne.vidal@gmail.com","0678459988","Soirs et samedis","Chant","Oui"],
    ["Guerin","Baptiste","Homme","13000","Marseille","26","Rue de la R√©publique","baptiste.guerin@gmail.com","0698456321","Week-ends","M√©canique","Oui"],
    ["No√´l","Clara","Femme","13000","Marseille","39","Rue Nationale","clara.noel@outlook.fr","0654789633","Dimanches","Cuisine","Non"],
    ["Renaud","Victorine","Femme","59000","Lille","2","Rue du Molinel","victor.renaud@gmail.com","0645789965","Samedis","Musique","Oui"],
    ["Marchand","Eva","Femme","69008","Lyon","25","Rue de l‚ÄôUniversit√©","eva.marchand@gmail.com","0678452314","Soirs","Th√©√¢tre","Oui"],
    ["Aubert","Maxine","Femme","31000","Toulouse","11","Rue de la Colombette","maxime.aubert@gmail.com","0659874123","Week-ends","Photographie","Non"]
]

# ----------------------------
# Conversion en DataFrame
# ----------------------------
columns = ["Nom","Pr√©nom","Sexe","Code postal","Ville","n¬∞ de rue","Rue","Email","T√©l√©phone","Disponibilit√©s","Comp√©tences","Newsletter"]
df = pd.DataFrame(data, columns=columns)

# ----------------------------
# Configuration de la page Streamlit
# ----------------------------
st.set_page_config(page_title="Analyse B√©n√©voles", page_icon="üìä", layout="wide")

st.title("üìä Analyse des b√©n√©voles de l'association")
st.write("Visualisation des donn√©es issues du tableau interne des b√©n√©voles.")

# ----------------------------
# Nettoyage et pr√©paration
# ----------------------------
df["Ville"] = df["Ville"].str.strip().str.title()
df["Sexe"] = df["Sexe"].str.strip().str.capitalize()

# ----------------------------
# 1Ô∏è‚É£ R√©partition hommes / femmes
# ----------------------------
st.subheader("üë´ R√©partition par sexe")
sexe_counts = df["Sexe"].value_counts(normalize=True) * 100
sexe_table = pd.DataFrame({
    "Sexe": sexe_counts.index,
    "Pourcentage": sexe_counts.values.round(0).astype(int)

    
})
st.table(sexe_table)

fig_sexe = px.pie(
    sexe_table,
    names="Sexe",
    values="Pourcentage",
    title="R√©partition Hommes / Femmes",
    color_discrete_sequence=["#66c2a5","#fc8d62"]
)
st.plotly_chart(fig_sexe, use_container_width=True)

# ----------------------------
# 2Ô∏è‚É£ Graphique : Nombre de b√©n√©voles par ville
# ----------------------------
st.subheader("üèôÔ∏è Nombre de b√©n√©voles par ville")
ville_counts = df.groupby("Ville").size().reset_index(name="Nombre de b√©n√©voles")
ville_counts = ville_counts.sort_values(by="Nombre de b√©n√©voles", ascending=False)

fig_villes = px.bar(
    ville_counts,
    x="Ville",
    y="Nombre de b√©n√©voles",
    text="Nombre de b√©n√©voles",
    color="Nombre de b√©n√©voles",
    color_continuous_scale="Blues",
    title="Nombre de b√©n√©voles par ville"
)
fig_villes.update_layout(
    xaxis_title="Ville",
    yaxis_title="Nombre de b√©n√©voles",
    xaxis_tickangle=-45
)
st.plotly_chart(fig_villes, use_container_width=True)

# ----------------------------
# 3Ô∏è‚É£ Tableau r√©sum√©
# ----------------------------
st.subheader("üìã D√©tail des villes")
st.dataframe(ville_counts)
